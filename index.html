<!DOCTYPE html>
<html lang="ru">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<link rel="icon" href="https://ru.siberianhealth.com/shopen/public/icon.svg" type="image/svg+xml">
<title>Розыгрыш!</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Jost:wght@100..900&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Shantell+Sans:wght@300..800&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif:wght@600&display=swap');

body{
font-family:Google Sans;
font-weight:500;
height:100vh;
text-align:center;
margin:0;
-webkit-tap-highlight-color:transparent;
}

#logo{
position:absolute;
top:1.875em;
left:2.5em;
background:url(https://ru.siberianhealth.com/static/rebranding/img/5a5c906883b9701f898e2281/1160434/upload-046af4b0-b821-11e8-89d0-798fa202fe62.png) 0 0 no-repeat;
background-size:100%;
width:12.5em;
height:12.5em;
}

#replay{
position:absolute;
top:3.25em;
right:7em;
width:2.5em;
height:2.5em;
cursor:pointer;
overflow:hidden;
}
#replay svg{
width:100%;
height:auto;
display:block;
}

#menu{
cursor:pointer;
position:absolute;
top:3.25em;
right:2.5em;
width:2.5em;
height:2.5em;
}
.menu,.menu:before,.menu:after{
content:'';
position:absolute;
width:100%;
left:0;
height:3.25px;
}
.menu{
top:50%;
margin-top:-1.125px;
}
.menu:before{
top:9px;
}
.menu:after{
bottom:9px;
}



#lotto{
position:absolute;
bottom:45vh;
width:100%;
font-size:1.5em;
}

#wrap_wrap_number{
user-select:none;
text-align:center;
margin-bottom:40px;
font-size:1.8em;
position:relative;
height:1.3em;
overflow:hidden;
}
#wrap_number{
position:absolute;
bottom:0;
width:100%;
height:1.3em;
line-height:1.3em;
transition:height .4s;
}

#generate{
user-select:none;
padding:20px 30px;
border-radius:40px;
display:inline-block;
margin:auto;
color:rgba(255,255,255,.4);
text-transform:uppercase;
letter-spacing:1px;
transition:color .4s;
}
#generate.open{
color:rgba(255,255,255,1);
cursor:pointer;
}

#wrap_winners{
font-size:1.8em;
position:absolute;
top:55vh;
margin-top:40px;
overflow:hidden;
text-align:center;
width:100%;
height:0;
transition:height .4s;
line-height:1.3em;
}



/* Полноэкранный режим */
#fullscreen{
position:absolute;
bottom:3.25em;
left:2.5em;
width:2.5em;
height:2.5em;
cursor:pointer;
overflow:hidden;
}
#fullscreen svg{
width:100%;
height:auto;
display:block;
}

:fullscreen #maximize{
display:none;
}
:-webkit-full-screen #maximize{
display:none;
}
:-moz-full-screen #maximize{
display:none;
}
:-ms-fullscreen #maximize{
display:none;
}

svg#minimize{
display:none;
}
:fullscreen #minimize{
display:block;
}
:-webkit-full-screen #minimize{
display:block;
}
:-moz-full-screen #minimize{
display:block;
}
:-ms-fullscreen #minimize{
display:block;
}



#wrap_wrap_lightbox{
display:none;
opacity:0;
transition:opacity .4s;
position:fixed;
top:0;
left:0;
width:100%;
height:100vh;
overflow:hidden;
z-index:1000;
}
#wrap_lightbox{
overflow-x:hidden;
background:#fff;
border-radius:2em 0 0 2em;
width:0;
transition:width .4s;
height:100vh;
position:absolute;
right:0;
font-family:Jost;
font-weight:400;
text-align:left;
}
#lightbox{
width:20em;
padding:0 40px 50px;
position:relative;
color:#333;
}
#lightbox_shadow{
width:100%;
height:100vh;
background:rgba(0,0,0,.5);
cursor:pointer;
}

#close{
cursor:pointer;
position:absolute;
top:0px;
right:2.5em;
width:2.5em;
height:2.5em;
}
.close:before,.close:after{
content:'';
position:absolute;
top:19px;
left:-6px;
width:130%;
height:2px;
background:#333;
}
.close:before{
transform:rotate(45deg);
}
.close:after{
transform:rotate(-45deg);
}

.headers{
font-weight:500;
margin:50px 0 1.25em 0;
text-transform:uppercase;
}

/* Опции настроек */
[type=radio]{
display:none;
}
[type=radio]+label{
cursor:pointer;
margin:5px 1.25em 10px 0;
display:inline-block;
color:#888;
}
[type=radio]:checked+label{
color:#F1574B;
}

/* Шрифты */
#Google_Sans+label{
font-family:Google Sans;
}
#Shantell_Sans+label{
font-family:Shantell Sans;
}
#Roboto_Slab+label{
font-family:Roboto Slab;
}
#Noto_Serif+label{
font-family:Noto Serif;
}

/* Темы */
[name=theme]+label{
border-radius:50%;
padding:1em;
margin:10px 0;
}
[name=theme]:checked+label{
background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%23fff' d='M9 21.035l-9-8.638 2.791-2.87 6.156 5.874 12.21-12.436 2.843 2.817z'/%3E%3C/svg%3E") 50% 50% no-repeat;
background-size:60%;
}

#theme_1+label{
background-color:#FFE19A;
}
body.theme_1{
background:radial-gradient(circle at bottom left,#FFE19A,transparent);
}
.menu.theme_1,.menu.theme_1:before,.menu.theme_1:after{
background:#84294B;
}
#wrap_wrap_number.theme_1,#wrap_winners.theme_1{
color:#84294B;
}
#generate.theme_1{
background:#D32C34;
}
#replay svg path.theme_1,svg#maximize path.theme_1,svg#minimize path.theme_1{
fill:#84294B;
}

#theme_2+label{
background-color:#FFCFDD;
}
body.theme_2{
background:radial-gradient(circle at top right,#FFCFDD,transparent);
}
.menu.theme_2,.menu.theme_2:before,.menu.theme_2:after{
background:#765E9A;
}
#wrap_wrap_number.theme_2,#wrap_winners.theme_2{
color:#765E9A;
}
#generate.theme_2{
background:#EF86B7;
}
#replay svg path.theme_2,svg#maximize path.theme_2,svg#minimize path.theme_2{
fill:#765E9A;
}

#theme_3+label{
background-color:#DCEDC8;
}
body.theme_3{
background:radial-gradient(circle at top left,#DCEDC8,transparent);
}
.menu.theme_3,.menu.theme_3:before,.menu.theme_3:after{
background:#2376BA;
}
#wrap_wrap_number.theme_3,#wrap_winners.theme_3{
color:#2376BA;
}
#generate.theme_3{
background:#74C95C;
}
#replay svg path.theme_3,svg#maximize path.theme_3,svg#minimize path.theme_3{
fill:#2376BA;
}

#theme_4+label{
background-color:#FFC7A5;
}
body.theme_4{
background:radial-gradient(circle at bottom right,#FFC7A5,transparent);
}
.menu.theme_4,.menu.theme_4:before,.menu.theme_4:after{
background:#5e62a9;
}
#wrap_wrap_number.theme_4,#wrap_winners.theme_4{
color:#5e62a9;
}
#generate.theme_4{
background:#FF6B6B;
}
#replay svg path.theme_4,svg#maximize path.theme_4,svg#minimize path.theme_4{
fill:#5e62a9;
}

#theme_5+label{
background-color:#B3E5FC;
}
body.theme_5{
background:#fff;
}
.menu.theme_5,.menu.theme_5:before,.menu.theme_5:after{
background:#333;
}
#wrap_wrap_number.theme_5,#wrap_winners.theme_5{
color:#333;
}
#generate.theme_5{
background:#54BEEE;
}
#replay svg path.theme_5,svg#maximize path.theme_5,svg#minimize path.theme_5{
fill:#333;
}

/* Настройки розыгрыша */
[type=text]{
color:inherit;
font-size:inherit;
font-weight:500;
font-family:inherit;
width:100%;
padding:5px 0 10px;
border:none;
border-bottom:2px solid #888;
outline:none;
appearance:none;
-webkit-appearance:none;
-moz-appearance:none;
}
[type=text]:focus{
border-bottom:2px solid transparent;
}
[type=text]:disabled{
background:none;
color:#888;
border-bottom:2px solid transparent;
}

[type=checkbox]{
display:none;
}
[type=checkbox]+label{
cursor:pointer;
margin:1.25em 0 0 0;
display:inline-block;
color:#888;
}
[type=checkbox]+label:before{
content:'+ ';
}
[type=checkbox]:checked+label{
color:#F1574B;
}
[type=checkbox]:checked+label:before{
content:'× ';
}

#start{
display:inline-block;
padding:15px 25px;
border-radius:30px;
color:#fff;
text-transform:uppercase;
letter-spacing:1px;
background:#F1574B;
cursor:pointer;
}

#list+label{
display:none;
}

ol{
display:none;
padding:0;
list-style-position:inside;
outline:none;
appearance:none;
-webkit-appearance:none;
-moz-appearance:none;
}



@media (hover:none) and (pointer:coarse){
	body{
	font-size:.85em;
	}

	.menu,.menu:before,.menu:after{
	height:3px;
	}
	.menu:before{
	top:8px;
	}
	.menu:after{
	bottom:8px;
	}

	#lightbox{
	font-size:1.3em;
	width:15em;
	padding:0 30px 40px;
	}
	#close{
	right:30px;
	}
	.headers{
	margin-top:40px;
	}
}
</style>
<div id="logo"></div>

<div id="replay">
	<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
		<path d="M18.5 8h-2.5v2h2.5c1.93 0 3.5 1.57 3.5 3.5s-1.57 3.5-3.5 3.5h-13c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5h2.5v3l6-4-6-4v3h-2.5c-3.037 0-5.5 2.463-5.5 5.5s2.463 5.5 5.5 5.5h13c3.037 0 5.5-2.463 5.5-5.5s-2.463-5.5-5.5-5.5z"/>
	</svg>
</div>
<div id="menu"><div class="menu"></div></div>

<div id="lotto">
	<div id="wrap_wrap_number">
		<div id="wrap_number">
			<div id="number"></div>
		</div>
	</div>
	<div id="generate">Разыграть</div>
</div>
<div id="wrap_winners">
	<div id="winners"></div>
</div>

<div id="fullscreen">
	<svg id="maximize" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
		<path d="M24 9h-2v-4h-4v-2h6v6zm-6 12v-2h4v-4h2v6h-6zm-18-6h2v4h4v2h-6v-6zm6-12v2h-4v4h-2v-6h6z"/>
	</svg>
	<svg id="minimize" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
		<path d="M18 3h2v4h4v2h-6v-6zm6 12v2h-4v4h-2v-6h6zm-18 6h-2v-4h-4v-2h6v6zm-6-12v-2h4v-4h2v6h-6z"/>
	</svg>
</div>

<div id="wrap_wrap_lightbox">
	<div id="wrap_lightbox">
		<div id="lightbox">
			<div id="close"><div class="close"></div></div>

			<div id="menu_settings">
				<div class="headers">Заголовок</div>
				<input type="radio" name="header" id="prize_draw" checked><label for="prize_draw">Розыгрыш</label>
				<input type="radio" name="header" id="lottery"><label for="lottery">Лотерея</label>
				<input type="radio" name="header" id="merchant"><label for="merchant">Купеческий&nbsp;закон</label>
				
				<div class="headers">Шрифт</div>
				<input type="radio" name="font" id="Google_Sans" checked><label for="Google_Sans">Google&nbsp;Sans</label>
				<input type="radio" name="font" id="Roboto_Slab"><label for="Roboto_Slab">Roboto&nbsp;Slab</label>
				<input type="radio" name="font" id="Shantell_Sans"><label for="Shantell_Sans">Shantell&nbsp;Sans</label>
				<input type="radio" name="font" id="Noto_Serif"><label for="Noto_Serif">Noto&nbsp;Serif</label>

				<div class="headers">Тема</div>
				<input type="radio" name="theme" id="theme_1" checked><label for="theme_1"></label>
				<input type="radio" name="theme" id="theme_2"><label for="theme_2"></label>
				<input type="radio" name="theme" id="theme_3"><label for="theme_3"></label>
				<input type="radio" name="theme" id="theme_4"><label for="theme_4"></label>
				<input type="radio" name="theme" id="theme_5"><label for="theme_5"></label>
			</div>
			<div id="menu_start">
				<div class="headers">Участников:</div>
				<input type="text" id="members" value="30" inputmode="numeric">

				<input type="checkbox" id="paste"><label for="paste">Вставить список участников из буфера обмена</label>

				<div class="headers">Призов:</div>
				<input type="text" id="prizes" value="3" inputmode="numeric">

				<div class="headers" id="start">Старт!</div>

				<input type="checkbox" id="list"><label for="list">Показать список участников</label>
				<ol contenteditable></ol>
			</div>
		</div>
	</div>
	<div id="lightbox_shadow"><div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script>
$(document).ready(function(){
	var randomNumber=function(min,max){
		return Math.floor(Math.random()*(max-min+1)+min);
	}
	let click;
	let random;
	let members;
	let prizes;

	// Меню настроек розыгрыша
	$('#replay').click(function(){
		$('#menu').trigger('click');
		$('#menu_settings').hide();
		$('#menu_start').show();

		setTimeout(()=>{
			$('#members').focus().val($('#members').val()).select();
		},800);
	});

	$('[type=text]').on('input',function(){
		if(this.value.match(/[^\d]/g)){
			this.value=this.value.replace(/[^\d]/g,'');
		}
	}).focus(function(){
		setTimeout(()=>{
			$(this).val($(this).val()).select();
		},100);
	});

	// Вставка имён участников
	$('#paste').click(function(){
		if($(this).is(':checked')){
			navigator.clipboard.readText().then(text=>{
				text='\n'+text.replace(/\d|\.|\,|\:|\#|\№/g,'').replace(/^\s+$/gm,'').replace(/^\n+/,'');
				$('ol').html(text.replaceAll('\n','<li>'));
				$('#members').val($('li').length).prop('disabled',true);
				$('#list+label').css('display','inline-block');
			}).catch(err=>{
				$('#paste').prop('checked',false);
				console.log('Опять чё-то не так',err);
			});
		}
		if(!$(this).is(':checked')){
			$('ol').html('').hide();
			$('#members').prop('disabled',false);
			$('#list+label').hide()
			$('#list').prop('checked',false);
		}
	});

	$('#list').click(function(){
		if($(this).is(':checked')){
			$('ol').show();
		}
		if(!$(this).is(':checked')){
			$('ol').hide();
		}
	});

	$('ol').on('input',function(){
		$('#members').val($('li').length);
	}).blur(function(){
		$(this).html($(this).html().replace(/\d|\.|\,|\:|\#|\№/g,'').replaceAll('<li><br></li>','').replaceAll('<br>','').replaceAll('<li></li>','').replace(/\ +|\t+|(?:&nbsp;)+/g,' ').replace(/^\ |\ $/gm,''));
		$('#members').val($('li').length);
	});

	// Начинаем розыгрыш
	$('#start').click(function(){
		members=Number($('#members').val());
		prizes=Number($('#prizes').val());
		if(members>=prizes&&members!=''&&prizes!=''&&members>0&&prizes>0){
			if(click>0){
				$('title').text($('[name=header]:checked+label').text()+'!');
				$('#number').html($('#number').html()+'<br>'+$('[name=header]:checked+label').text()+'!');
				$('#wrap_number').animate({height:$('#number').height()},0);

				$('#wrap_winners').animate({height:0},0,function(){
					setTimeout(()=>{
						$('#winners').html('');
					},400);
				});
			}

			click=0;
			random=[];

			$('#generate').addClass('open');
			$('#close').trigger('click');
		}
	});

	// Генерируем случайное число
	$('#generate').click(function(){
		if($('#generate').hasClass('open')&&click<members&&click<prizes){
			click++;
			do{
				var num=randomNumber(1,members);
			}
			while(random.indexOf(num)>-1);
			random.push(num);
			var delay=1600;
			$('#number').html($('#number').html()+'<br>Интрига...');
			$('#wrap_number').animate({height:$('#number').height()},0);

			$('#generate').removeClass('open');

			$('#number').html($('#number').html()+'<br>'+num);
			$('#wrap_number').delay(delay).animate({height:$('#number').height()},0,function(){
				$('#number').html($('#number').html()+'<br>Поздравляем!');
				$('#wrap_number').delay(delay).animate({height:$('#number').height()},0);

				if(click<members&&click<prizes){
					setTimeout(()=>$('#generate').addClass('open'),delay);
				}

				var winner=$('#paste').is(':checked')?`#${click}: ${$('li').eq(num-1).text()}`:`${click}-й приз: ${num}`;
				$('#winners').html($('#winners').html()+'<br>'+winner).html($('#winners').html().replace(/^\<br\>/,''));
				$('#wrap_winners').delay(delay).animate({height:$('#winners').height()},0);
			});
		}
	});

	//$('???').css('transition-duration').replace('s','')*1000(=400)
	$('#menu').click(function(){
		if($('#menu_start').is(':hidden')){
			$('#menu_settings').show();
			$('#menu_start').hide();
		}
		$('body').css('user-select','none');
		$('#wrap_wrap_lightbox').css('display','block').animate({opacity:1},0);
		$('#wrap_lightbox').delay(400).animate({width:$('#lightbox').innerWidth()},0);
	});
	$('#close').click(function(){
		$('#wrap_lightbox').animate({width:0},0);
		$('#wrap_wrap_lightbox').delay(400).animate({opacity:0},0,function(){
			setTimeout(()=>{
				$('#wrap_wrap_lightbox').css('display','none');
				$('body').css('user-select','auto');
			},400);
		});
	});

	// Drag-событие на вызов и отзыв меню
	mouseDrag=[];
	touchDrag=[];
	$('body').mousedown(function(e){
		if(e.which==1){ // Чтобы только с левой кнопки двигалось
			mouseDrag[0]=1;
			mouseDrag[1]=e.pageX;
		}
	}).mouseup(function(e){
		mouseDrag=[];
	}).mousemove(function(e){
		mouseDrag[2]=e.pageX;
		if(mouseDrag[2]-mouseDrag[1]>150){
			$('#close').trigger('click');
			mouseDrag=[];
		}
		if(mouseDrag[2]-mouseDrag[1]<-150&&mouseDrag[1]>$(window).width()/1.33){
			$('#menu').trigger('click');
			mouseDrag=[];
		}
	}).on('touchstart',function(e){
		touchDrag[0]=1;
		touchDrag[1]=e.originalEvent.touches[0].pageX;
	}).on('touchend',function(e){
		touchDrag=[];
	}).on('touchmove',function(e){
		touchDrag[2]=e.originalEvent.touches[0].pageX;
		if(touchDrag[2]-touchDrag[1]>150){
			$('#close').trigger('click');
			touchDrag=[];
		}
		if(touchDrag[2]-touchDrag[1]<-150&&touchDrag[1]>$(window).width()/1.33){
			$('#menu').trigger('click');
			touchDrag=[];
		}
	});

	// Убираем меню по нажатию на его подложку
	$('#lightbox_shadow').click(function(e){
		$('#close').trigger('click');
	});

	// События клавиатуры
	$(document).on('keydown keyup',function(e){
		if(e.type=='keyup'){ // Предотварщение срабатываний при удержании клавиш
			setTimeout(()=>{
				$('#wrap_lightbox,#prizes').removeClass('stop');
			},0);
		}
		if(e.key=='Escape'){ // События на Esc
			$('#close').trigger('click');
		}
		if(e.key=='Enter'){ // События на Enter
			if($('#wrap_lightbox').is(':hidden')&&!$('#wrap_lightbox').hasClass('stop')){
				$('#wrap_lightbox').addClass('stop');
				$('#generate').trigger('click');
			}
			if($('#members').is(':focus')){
				$('#prizes').addClass('stop').focus();
			}
			if($('#prizes').is(':focus')&&!$('#prizes').hasClass('stop')){
				$('#start').trigger('click');
			}
		}
	});

	// Полноэкранный режим
	$('#maximize').click(function(){
		var fullscreen=$('html')[0];
		if(fullscreen.requestFullscreen){
			fullscreen.requestFullscreen();
		}else if(fullscreen.webkitRequestFullscreen){
			fullscreen.webkitRequestFullscreen();
		}else if(fullscreen.msRequestFullscreen){
			fullscreen.msRequestFullscreen();
		}else if(fullscreen.mozRequestFullScreen){
			fullscreen.mozRequestFullScreen();
		}
	});
	$('#minimize').click(function(){
		if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement){
			if(document.exitFullscreen){
				document.exitFullscreen();
			}else if(document.webkitExitFullscreen){
				document.webkitExitFullscreen();
			}else if(document.mozCancelFullScreen){
				document.mozCancelFullScreen();
			}else if(document.msExitFullscreen){
				document.msExitFullscreen();
			}
		}
	});

	// Выбор заголовков и их запись в Cookies
	if(localStorage['lotto_sw_header']){
		$('#'+localStorage['lotto_sw_header']).prop('checked',true);
	}
	$('#number,title').text($('[name=header]:checked+label').text()+'!');

	$('[name=header]').click(function(){
		if(localStorage['lotto_sw_header']!=$(this).attr('id')){
			localStorage['lotto_sw_header']=$(this).attr('id');
			if(click==0||click==prizes){
				$('title').text($('[name=header]:checked+label').text()+'!');
				$('#number').html($('#number').html()+'<br>'+$('[name=header]:checked+label').text()+'!');
				$('#wrap_number').animate({height:$('#number').height()},0);

				$('#wrap_winners').animate({height:0},0,function(){
					setTimeout(()=>{
						$('#winners').html('');
					},400);
				});
				
				click=0;
			}
		}
	});

	// Выбор шрифтов и их запись в Cookies
	if(localStorage['lotto_sw_font']){
		$('#'+localStorage['lotto_sw_font']).prop('checked',true);
	}
	$('body').css('font-family',$('[name=font]:checked+label').text().replace(/\s/g,' '));

	$('[name=font]').click(function(){
		localStorage['lotto_sw_font']=$(this).attr('id');
		$('body').css('font-family',$('[name=font]:checked+label').text().replace(/\s/g,' '));
	});

	// Выбор тем и их запись в Cookies
	if(localStorage['lotto_sw_theme']){
		$('#'+localStorage['lotto_sw_theme']).prop('checked',true);
	}
	$('*').addClass($('[name=theme]:checked').attr('id'));

	$('[name=theme]').click(function(){
		localStorage['lotto_sw_theme']=$(this).attr('id');
		for(let i=0;i<=$('[name=theme]').length;i++){
			$('*').removeClass('theme_'+i).addClass(localStorage['lotto_sw_theme']);
		}
	});
});
</script>
